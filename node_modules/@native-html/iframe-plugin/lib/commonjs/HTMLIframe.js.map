{"version":3,"sources":["HTMLIframe.tsx"],"names":["RM_BODY_SPACING_CSS","features","HandleLinkPressFeature","preventDefault","HTMLIframe","WebView","webViewProps","userWebViewProps","source","style","onLinkPress","scaleFactor","injectedCSSStyles","removeBodySpacing","scalesPageToFit","onDOMLinkPress","event","apply","injectedCss","concat","assembledFeatures","feats","ForceResponsiveViewportFeature","initScale","maxScale","minScale","push","InjectStyleFeature","css","props","testID"],"mappings":";;;;;;;AAAA;;AACA;;AAOA;;AAEA;;;;;;AAoFA,MAAMA,mBAAmB,GACvB,oDADF;AAGA,MAAMC,QAAQ,GAAG,CAAC,IAAIC,gCAAJ,CAA2B;AAAEC,EAAAA,cAAc,EAAE;AAAlB,CAA3B,CAAD,CAAjB;AAEA;AACA;AACA;AACA;AACA;;AACe,SAASC,UAAT,CAAoB;AACjCC,EAAAA,OADiC;AAEjCC,EAAAA,YAAY,EAAEC,gBAFmB;AAGjCC,EAAAA,MAHiC;AAIjCC,EAAAA,KAJiC;AAKjCC,EAAAA,WALiC;AAMjCC,EAAAA,WANiC;AAOjCC,EAAAA,iBAPiC;AAQjCC,EAAAA,iBARiC;AASjCC,EAAAA,eAAe,GAAG;AATe,CAApB,EAUK;AAClB,QAAMC,cAAc,GAAG,wBACpBC,KAAD,IACEN,WADF,aACEA,WADF,uBACEA,WAAW,CAAEO,KAAb,CAAmB,IAAnB,EAAyB,sDAAoCD,KAApC,CAAzB,CAFmB,EAGrB,CAACN,WAAD,CAHqB,CAAvB;AAKA,QAAMQ,WAAW,GAAG,oBAClB,MACE,CAAEL,iBAAiB,IAAIb,mBAAtB,IAA8C,EAA/C,EAAmDmB,MAAnD,CACEP,iBAAiB,IAAI,EADvB,CAFgB,EAKlB,CAACA,iBAAD,EAAoBC,iBAApB,CALkB,CAApB;AAOA,QAAMO,iBAAiB,GAAG,oBAAQ,MAAM;AACtC,UAAMC,KAAK,GAAG,CACZ,GAAGpB,QADS,EAEZ,IAAIqB,wCAAJ,CAAmC;AACjCC,MAAAA,SAAS,EAAET,eAAe,GAAGH,WAAH,GAAiB,CADV;AAEjCa,MAAAA,QAAQ,EAAEV,eAAe,GAAGH,WAAH,GAAiB,CAFT;AAGjCc,MAAAA,QAAQ,EAAEX,eAAe,GAAGH,WAAH,GAAiB;AAHT,KAAnC,CAFY,CAAd;;AAQA,QAAIO,WAAJ,EAAiB;AACfG,MAAAA,KAAK,CAACK,IAAN,CACE,IAAIC,4BAAJ,CAAuB;AACrBC,QAAAA,GAAG,EAAEV;AADgB,OAAvB,CADF;AAKD;;AACD,WAAOG,KAAP;AACD,GAjByB,EAiBvB,CAACH,WAAD,EAAcP,WAAd,EAA2BG,eAA3B,CAjBuB,CAA1B;AAkBA,QAAMR,YAAY,GAAG,2BAAY;AAC/BL,IAAAA,QAAQ,EAAEmB,iBADqB;AAE/BS,IAAAA,KAAK,EAAE,EACL,GAAGtB,gBADE;AAELQ,MAAAA,cAFK;AAGLP,MAAAA,MAHK;AAILsB,MAAAA,MAAM,EAAE;AAJH;AAFwB,GAAZ,CAArB,CA/BkB,CAwClB;AACA;;AACA,sBACE,6BAAC,iBAAD;AAAM,IAAA,KAAK,EAAErB;AAAb,kBACE,6BAAC,OAAD,EAAaH,YAAb,CADF,CADF;AAKD","sourcesContent":["import React, { ComponentType, useCallback, useMemo } from 'react';\nimport {\n  HandleLinkPressFeature,\n  InjectStyleFeature,\n  ForceResponsiveViewportFeature,\n  LinkPressTarget,\n  useWebshell\n} from '@formidable-webview/webshell';\nimport { StyleProp, View, ViewStyle } from 'react-native';\nimport { RenderersProps } from 'react-native-render-html';\nimport { linkPressTargetToOnDOMLinkPressArgs } from '@native-html/plugins-core';\n\n/**\n * Configuration options for the HTMLIframe component.\n * You can pass those options through `renderersProps.iframe`\n * HTML prop.\n *\n * @public\n */\nexport interface IframeConfig {\n  /**\n   * When the iframe attribute width is wider than the contentWidth, scales\n   * down the viewport so that it doesn't overflows horizontally.\n   *\n   * @remarks Although it looks like the eponymous `WebView` prop, it works\n   * both on iOS and Android.\n   *\n   * @defaultvalue false\n   */\n  scalesPageToFit?: boolean;\n\n  /**\n   * When `true`, a stylesheet will be inserted in the `WebView` to remove\n   * padding and margins for the `body` element.\n   */\n  removeBodySpacing?: boolean;\n\n  /**\n   * When defined, the provided CSS will be injected in a `style` element.\n   */\n  injectedCSSStyles?: string;\n\n  /**\n   * Any props you'd like to pass to the `WebView` component.\n   *\n   * @remarks\n   * `source` and `javascriptEnabled` will be ignored and overriden.\n   */\n  webViewProps?: any;\n}\n\n/**\n * Props for the HTMLIframe component.\n *\n * @public\n */\nexport interface HTMLIframeProps<WebViewProps = any> extends IframeConfig {\n  /**\n   * The `WebView` Component you wish to use.\n   */\n  WebView: ComponentType<WebViewProps>;\n\n  /**\n   * Props to be passed to the `WebView` component;\n   */\n  webViewProps?: WebViewProps;\n\n  /**\n   * The source for the iframe.\n   */\n  source: { uri?: string; html?: string };\n\n  /**\n   * Container style.\n   */\n  style: StyleProp<ViewStyle>;\n\n  /**\n   * Handle link press events.\n   */\n  onLinkPress?: RenderersProps['a']['onPress'];\n\n  /**\n   * Html attributes for this iframe node.\n   */\n  htmlAttribs: Record<string, string>;\n\n  /**\n   * When scalesPageToFit is enabled, scales the WebView zoom level to make sure the\n   * viewport fits contentWidth.\n   */\n  scaleFactor: number;\n}\n\nconst RM_BODY_SPACING_CSS =\n  'body{padding: 0 !important; margin: 0 !important;}';\n\nconst features = [new HandleLinkPressFeature({ preventDefault: true })];\n\n/**\n * A component to render iframes in react-native-render-html.\n *\n * @public\n */\nexport default function HTMLIframe({\n  WebView,\n  webViewProps: userWebViewProps,\n  source,\n  style,\n  onLinkPress,\n  scaleFactor,\n  injectedCSSStyles,\n  removeBodySpacing,\n  scalesPageToFit = false\n}: HTMLIframeProps) {\n  const onDOMLinkPress = useCallback(\n    (event: LinkPressTarget) =>\n      onLinkPress?.apply(null, linkPressTargetToOnDOMLinkPressArgs(event)),\n    [onLinkPress]\n  );\n  const injectedCss = useMemo(\n    () =>\n      ((removeBodySpacing && RM_BODY_SPACING_CSS) || '').concat(\n        injectedCSSStyles || ''\n      ),\n    [injectedCSSStyles, removeBodySpacing]\n  );\n  const assembledFeatures = useMemo(() => {\n    const feats = [\n      ...features,\n      new ForceResponsiveViewportFeature({\n        initScale: scalesPageToFit ? scaleFactor : 1,\n        maxScale: scalesPageToFit ? scaleFactor : 1,\n        minScale: scalesPageToFit ? scaleFactor : 1\n      })\n    ];\n    if (injectedCss) {\n      feats.push(\n        new InjectStyleFeature({\n          css: injectedCss\n        }) as any\n      );\n    }\n    return feats;\n  }, [injectedCss, scaleFactor, scalesPageToFit]);\n  const webViewProps = useWebshell({\n    features: assembledFeatures,\n    props: {\n      ...userWebViewProps,\n      onDOMLinkPress,\n      source,\n      testID: 'iframe'\n    }\n  });\n  // We need to wrap the WebView in a View to circumvent a bug in\n  // react-native-webview, see https://git.io/JKY1r\n  return (\n    <View style={style}>\n      <WebView {...webViewProps} />\n    </View>\n  );\n}\n"]}